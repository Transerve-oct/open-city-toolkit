html
  head
    title Open City Toolkit

    link(rel='stylesheet' href='/lib/bootstrap/css/bootstrap.min.css')
    link(rel='stylesheet' href='/lib/leaflet/leaflet.css')
    link(rel='stylesheet' href='/lib/leaflet-draw/leaflet.draw.css')

    script(src='/lib/jquery/jquery.min.js')
    script(src='/lib/bootstrap/js/bootstrap.bundle.min.js')
    script(src='/lib/leaflet/leaflet.js')
    script(src='/lib/leaflet-draw/leaflet.draw.js')
    script(src='/lib/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.js')

    style
      include style.css
      include ../map/style.css
      include ../results-modal/style.css
      include ../help-modal/style.css

  body
    div(class="d-flex flex-column h-100")
      div(class="card box-shadow")
        nav(class="navbar navbar-expand navbar-light")
          a(class="navbar-brand font-weight-bold") Open City Toolkit
          ul(class="navbar-nav flex-grow-1 justify-content-space-evenly")
            li(class="nav-item d-flex align-items-center")
              span(class="d-inline-block align-middle m-2") Modules:
              select(id='launch-module-menu' class='custom-select custom-select-lg mr-2')
                option(selected value='module_1a') Calculate time map
                option(value='module_2') Query area
              button(class='btn btn-success btn-lg mr-2' onclick='launchModule()') ▷&nbsp;Run
              button(class='btn btn-light btn-lg' id="result-btn" onclick='showResults()') Results
            li(class="nav-item flex-grow-1")
            li(class="nav-item dropdown")
              a(class="btn btn-lg nav-link dropdown-toggle" id="settings-menu" data-toggle="dropdown") Settings
              div(class="dropdown-menu dropdown-menu-right")
                a(class="btn dropdown-item" onclick="launchSettings('add_location')") Set location
                div(class="dropdown-divider")
                a(class="btn dropdown-item" onclick="launchSettings('set_selection')") Set selection
                div(class="dropdown-divider")
                a(class="btn dropdown-item" onclick="launchSettings('set_resolution')") Set resolution
                div(class="dropdown-divider")
                a(class="btn dropdown-item" onclick="launchSettings('add_map')") Add map
            li(class="nav-item")
              button(class='btn btn-secondary btn-lg' onclick='show_help()') Help

      div(class="d-flex flex-grow-1 main")
        div(class='d-flex flex-column w-25 sidebar')
          div(id='dialog' class='flex-grow-1 card card-border box-shadow')
            div(id='textarea')
            div(id='lists')
            div(id='buttonarea' class='btn-group')

          div(class='card flex-row justify-content-center')
            div(class='d-block')
              img(src='images/giz-logo.gif' id='giz-logo')
              img(src='images/hcu-logo.png' id='hcu-logo')

        div(id='map-container' class='col card box-shadow')
          include ../map/index.pug

        div(id='alert-anchor')

        div(id='loading')
          div(class='loading-text') Processing …
          div(class='spinner spinner-border')

    div(id='results-modal' class='modal-background')
      include ../results-modal/index.pug

    div(id='help-modal' class='modal-background')
      include ../help-modal/index.pug

    div(id='table-attributes-modal' class='modal-background')
      include ../table-attributes-modal/index.pug

    script.
      //- enable Bootstrap tooltip on module select
      $(function () {
        const options = {
          placement: 'bottom',
          title: function () {
            switch ($(this).val()) {
              case 'module_1a': return 'The ‘Calculate time map’ module creates a map showing the time it takes to reach any part of the selected area from a given start point. Optionally, via points and/or affected areas with reduced speed can be defined.';
              case 'module_2': return 'The ‘Query area’ module lets you filter map features based on a given set of constraints. For example, if a housing map layer is queried based on the household population and monthly income, only the houses within the given range will be returned.';
            }
          },
          trigger: 'manual'
        };
        const target = $('#launch-module-menu');
        target.tooltip(options);
        target.on('focusin change', () => target.tooltip('show'));
        target.on('focusout', () => target.tooltip('hide'));
      });
      //- environment variables
      const geoserverUrl = '#{geoserverUrl}';
      const [lat, lon] = [#{lat}, #{lon}];
    script
      include script.js
      include ../map/legend.js
      include ../map/script.js
      include ../results-modal/script.js
      include ../help-modal/script.js
      include ../table-attributes-modal/script.js
